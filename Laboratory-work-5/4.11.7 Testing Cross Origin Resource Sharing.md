# Тестування спільного використання ресурсів між джерелами

Тестування спільного використання ресурсів між джерелами (CORS - Cross-Origin Resource Sharing) є важливим аспектом безпеки та взаємодії веб-додатків. CORS дозволяє або обмежує доступ до ресурсів веб-сервера з інших доменів, що може бути корисним для забезпечення безпеки веб-додатків, а також для налаштування правильних політик доступу.

У цій статті ми розглянемо, що таке CORS, чому воно важливе і як проводиться тестування для перевірки правильності налаштувань CORS.

## 1. Мета тестування CORS

Мета тестування CORS полягає в тому, щоб перевірити, чи дозволяється доступ до ресурсів веб-додатка з інших доменів та чи застосовуються належні політики для забезпечення безпеки. Основні цілі тестування включають:

- Перевірка того, чи налаштувано правильне обмеження доступу до ресурсів.
- Тестування, чи запити з інших доменів обробляються коректно.
- Перевірка наявності потенційних вразливостей, пов'язаних з дозволом небажаних запитів з інших доменів.

## 2. Як працює CORS

CORS — це механізм, який дозволяє веб-браузерам контролювати доступ до ресурсів, що знаходяться на інших доменах. Коли веб-додаток намагається здійснити запит до ресурсу, який знаходиться на іншому домені, браузер спочатку надішле **preflight-запит** (OPTIONS), щоб перевірити, чи дозволяє сервер доступ з цього домену.

Якщо сервер відповідає правильними заголовками, браузер дозволяє виконати основний запит. Основні заголовки CORS:

- **Access-Control-Allow-Origin** — визначає, які домени можуть отримувати доступ до ресурсів.
- **Access-Control-Allow-Methods** — визначає методи HTTP, які дозволяються для доступу.
- **Access-Control-Allow-Headers** — визначає, які заголовки можуть бути використані під час запиту.
- **Access-Control-Allow-Credentials** — визначає, чи дозволяється надсилати облікові дані (cookies, HTTP-автентифікація).

## 3. Типи запитів CORS

### 3.1. Простий запит

Простий запит відправляється, якщо запит відповідає таким критеріям:

- Метод: GET, POST або HEAD.
- Заголовки: лише базові заголовки, такі як `Accept`, `Content-Type` тощо.

### 3.2. Запит з попередньою перевіркою (Preflight Request)

Якщо запит не є простим, браузер надсилає попередній запит з методом OPTIONS для перевірки прав доступу. Попередній запит може включати додаткові заголовки, методи або інші параметри, що потребують особливої перевірки.

## 4. Методи тестування CORS

### 4.1. Тестування за допомогою інструментів розробника

Використання інструментів розробника в браузері для тестування запитів CORS є одним з найбільш простих і доступних способів перевірки політик CORS:

1. **Google Chrome DevTools**:
    - Відкрийте DevTools (F12).
    - Перейдіть на вкладку "Network".
    - Виконайте запит до ресурсу з іншого домену.
    - Перевірте заголовки відповіді, такі як `Access-Control-Allow-Origin`.

2. **Mozilla Firefox Developer Tools**:
    - Відкрийте DevTools (F12).
    - Перейдіть на вкладку "Network".
    - Перевірте заголовки запитів та відповідей на наявність CORS.

### 4.2. Використання спеціальних інструментів

Існують інструменти для перевірки CORS, які допомагають автоматизувати тестування та виявлення проблем:

- **Postman**: Інструмент для відправки запитів, який дозволяє тестувати CORS-запити з різних доменів.
- **CORS Anywhere**: Інструмент для тестування CORS-запитів, що дозволяє обійти обмеження CORS і перевірити поведінку запитів.
- **curl**: Командний рядок для відправки HTTP-запитів, що дозволяє перевірити заголовки CORS.

### 4.3. Перевірка на обмеження доступу

Перевірка налаштувань CORS на сервері включає такі кроки:

1. Надіслати запит з різних доменів і перевірити, чи сервер відповідає відповідними заголовками.
2. Перевірити різні методи запитів (GET, POST, DELETE) для визначення того, чи сервер підтримує їх для різних джерел.
3. Перевірити, чи сервер дозволяє доступ до ресурсів лише для визначених доменів.

### 4.4. Тестування на захист від несанкціонованих запитів

Перевірка на те, чи правильно сервер блокує запити з небажаних доменів. Для цього необхідно:

1. Відправити запит із домену, який не входить до дозволених у політиці CORS.
2. Переконатися, що сервер відповідає помилкою (наприклад, 403 або 401), а не дозволяє доступ.

## 5. Приклад налаштування CORS на сервері

### 5.1. Налаштування CORS у Node.js

```javascript
const cors = require('cors');
const express = require('express');
const app = express();

// Дозволити доступ лише з певного домену
app.use(cors({
  origin: 'https://example.com',
  methods: ['GET', 'POST'],
  allowedHeaders: ['Content-Type']
}));

app.get('/data', (req, res) => {
  res.json({ message: 'Hello, world!' });
});

app.listen(3000, () => {
  console.log('Server is running on port 3000');
});